<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JotForm Custom Widget</title>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>
<body>

    <input type="text" id="textInput" placeholder="Inserisci Codice Fiscale" maxlength="16"  />


    <script type="text/javascript">

       const maskPattern = "@@@@@@##@##@###@"; // Define your mask
       const placeholderChar = "_"; // Placeholder for missing characters

      function enforceMask(inputValue) {
          let maskedValue = "";
          let valueIndex = 0;

          for (let i = 0; i < maskPattern.length; i++) {
              let currentMask = maskPattern[i];
              let currentChar = inputValue[valueIndex] || ""; // Get next input character

              if (currentMask === "@") {
                  if (/[A-Za-z]/.test(currentChar)) {
                      maskedValue += currentChar.toUpperCase();
                      valueIndex++;
                  } else {
                      maskedValue += placeholderChar; // Keep length
                  }
              } else if (currentMask === "#") {
                  if (/[0-9]/.test(currentChar)) {
                      maskedValue += currentChar;
                      valueIndex++;
                  } else {
                      maskedValue += placeholderChar; // Keep length
                  }
              } else {
                  maskedValue += currentMask; // Fixed mask character
              }
          }

          return maskedValue;
      }

      document.getElementById("textInput").addEventListener("input", function(event) {
          let rawValue = this.value.replace(/[^A-Za-z0-9]/g, ''); // Remove any unwanted characters
          this.value = enforceMask(rawValue);
      });

      JFCustomWidget.subscribe("ready", function(){

        JFCustomWidget.subscribe("submit", function() {
               
          let text = document.getElementById("textInput").value;
          JFCustomWidget.sendSubmit({ valid: true, value: text });

        });
      });
      
    </script>
    
</body>
</html>
